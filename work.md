# CityAir (август 2025)

---

## 1. Цели и задачи проекта

### 1.1. Основные задачи

1. Разработка методики восстановления концентраций загрязняющих веществ:
    - Построить ML-модели для оценки концентраций по сигналам сенсоров с учетом влияния температуры, влажности, кросс-чувствительности и деградации.

2. Учёт деградации сенсоров:
    - Разработать подход к мониторингу старения сенсоров, прогнозу срока эксплуатации, автоматизации перекалибровки.

3. Валидация:
    - Проверить работоспособность методики на лабораторных и полевых данных.

---

## 2. Подготовка и анализ данных

### 2.1. Источники данных

- Лабораторные данные: серии экспериментов с подачей газов, фиксированной температурой/влажностью, baseline и плато.
- Полевые данные: временные ряды с реальных станций, погодные параметры (температура, влажность, давление).

### 2.2. Анализ лабораторных данных (EDA)

[EDA.ipynb] [cityair_data.ipynb] [read_data.py]
- Сигналы четко отражают ступенчатые изменения при подаче/отключении газа.
- Выражена инерция отклика (релаксация сигнала).  
- Есть выбросы и нехарактерные скачки (тех. паузы, сбои подачи).
- Сильная корреляция между сигналом основного электрода и концентрацией "своего" газа.
- Умеренные cross-связи между газами (особенно NO₂ и O₃), влияние температуры и влажности.
- Статусные метки baseline слишком малочислены. Добавлены свои разметки. 

### 2.3. Анализ полевых данных

- Данные более шумные, baseline "плавает".
- Встречаются пропуски, периоды обслуживания и сбои.

---

## 3. Методология построения моделей

### 3.1. Признаки и особенности датчиков

- Использованы основные и вспомогательные сигналы (op1, op2), температуры, влажности, статусы baseline/stat, cross-сигналы других газов.
- Эталонные концентрации доступны для калибровки на лабораторных данных.
- Коррекция baseline — через статистические маски и rolling-фильтрацию.[read_data.py]

### 3.2. Учет кросс-газовых эффектов

[LR_2.ipynb]
- Кросс-чувствительность компенсируется добавлением сигналов других газов в признаки.
- Для NO₂ и O₃ особенно информативны взаимные сигналы.

### 3.3. Типы моделей

[LR_2.ipynb]
- Regression-модель (CatBoost):
    - ML-регрессия по всем признакам, целевой — концентрация газа.
    - Устраняет кросс-чувствительность, дрейф baseline, учитывает параметры среды.
- Sens-модель:
    - ML-регрессия для ∆signal = op1 - baseline на статичных участках.
    - Диагностика baseline, малых/шумных изменений, технических аномалий.

---

## 4. Основные результаты

### 4.1. Regression-модели (CatBoost, по концентрации)

| Газ  | Кол-во baseline | Кол-во рабочих (stat) | R² baseline | nrMSE baseline | R² регрессии | nrMSE регрессии |
|------|-----------------|----------------------|-------------|----------------|--------------|-----------------|
| H₂S  | 321 350         | 52 928               | 0.711       | 0.538          | 0.901        | 0.314           |
| SO₂  | 354 155         | 73 638               | 0.814       | 0.432          | 0.994        | 0.076           |
| O₃   | 386 532         | 78 411               | 0.670       | 0.575          | 1.000        | 0.012           |
| CO   | 386 254         | 80 089               | 0.797       | 0.451          | 0.988        | 0.109           |
| NO₂  | 387 783         | 77 644               | 0.747       | 0.503          | 0.985        | 0.122           |

**Комментарий:** Качество восстановления концентраций по всем газам соответствует промышленным требованиям (R² > 0.9 для всех, кроме baseline-моделей H₂S и O₃).

### 4.2. Sens-модели (разность сигнала, ∆signal = op1 - baseline)

| Газ  | Кол-во baseline | Кол-во рабочих (stat) | R² baseline | nrMSE baseline | R² sens-модели | nrMSE sens-модели |
|------|-----------------|----------------------|-------------|----------------|----------------|-------------------|
| H₂S  | 302 082         | 52 928               | 0.742       | 0.508          | 0.067          | 0.966             |
| SO₂  | 342 121         | 73 638               | 0.813       | 0.432          | 0.446          | 0.744             |
| O₃   | 376 999         | 78 411               | 0.699       | 0.549          | 0.630          | 0.608             |
| CO   | 386 254         | 80 089               | 0.797       | 0.451          | 0.822          | 0.421             |
| NO₂  | 377 241         | 77 644               | 0.755       | 0.495          | 0.781          | 0.468             |

**Комментарий:** Sens-модели полезны для диагностики baseline и выявления сложных случаев на “чистых” плато, где сигнал слабо отличается от baseline или подвержен шуму.

### 4.3. Валидация на полевых данных
   
   После улучшения stat, bl разметки


### 4.4. Динамические (LSTM) модели

Изучаем
- LSTM/GRU позволяют моделировать сложные "хвосты" сигнала после скачков концентрации.
- Особенно эффективны для переходных процессов и сенсоров с долгим временем релаксации.


---

## 6. Следующие шаги

*  Продолжить эксперименты с динамическими моделями (LSTM, seq2seq) на реальных длинных сериях.
* Составление запроса на дополнительные лабораторные эксперименты (диапазоны температур, влажности и т.д.).
*  Учёт деградации сенсоров


---
